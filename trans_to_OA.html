<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Source LIFF (Auto Redirect)</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  </head>
  <body>
    <h3>Redirecting to destination LIFF...</h3>
    <div id="user-info"></div>

    <script>
      async function main() {
        try {
          await liff.init({ liffId: "1656384751-4l7Rvlab" });

          if (!liff.isLoggedIn()) {
            liff.login();
            return;
          }

          const profile = await liff.getProfile();
          const userInfoDiv = document.getElementById("user-info");
          userInfoDiv.innerHTML = `
            <p>User ID: ${profile.userId}</p>
            <p>Display Name: ${profile.displayName}</p>
          `;

          // 延遲 2 秒再跳轉到外部連結
          setTimeout(() => {
            // 方式 1：同分頁導向
            window.location.href = "https://line.me/R/oaMessage/@@904ojrm?userId=" + encodeURIComponent(profile.userId);

            // 方式 2（選擇性）：新分頁開啟
            // window.open("https://line.me/R/oaMessage/@@904ojrm?userId=" + encodeURIComponent(profile.userId), "_blank");
          }, 2000);

        } catch (err) {
          document.body.innerHTML = "<p>Init failed: " + err + "</p>";
          console.error(err);
        }
      }

      main();
    </script>
  </body>
</html>
